# 使用Java对40亿个数进行排序
项目来源：软件体系结构课程实验
## 性能
总耗时：约13分钟
## 相关技术
Java并发编程、Java文件操作、归并排序、堆
## 详细说明
### 1、数据拆分
40亿个int型整数无法一次性全部读入内存，所以进行拆分，分批次读入内存，分别排序，最后归并。
本程序使用的线程池包含8个线程，每个线程操作俩千万个整数，共计需要约610MB内存。

### 2、线程任务分配
创建一个具有固定大小的线程池，考虑到排序输入CPU密集型任务，这里设置线程池的大小为本机CPU数量的俩倍，即8个线程。

该线程池将控制线程数量最多为8，避免线程数量过多，增加上下文切换的开销

为每个子线程分配一个俩千万大小的数组，对其进行排序，排序结果存入临时文件中。所有子线程完成排序任务后，主线程开始对200个文件进行归并。

这里通过CountDownLatch来保证子线程和主线程的同步运行，保证所有排序任务完成后再进行归并。

### 3、子线程排序
子线程中调用Arrays.sort()方法，对数组进行排序
### 4、归并
> 整体来看，对200个文件进行归并属于归并排序，而在归并过程中，比如在比较200个数的大小的时候，使用的则是堆排序。综合来看这个归并过程结合了归并排序和堆排序的思想，提高了归并的效率。
* 读取各个文件的最小值并存入小根堆（同时存储该数的来源，即来自哪个文件）
* 获取小根堆中的堆顶元素，写入目标文件（即存放最终排序结果的文件）
* 删除小根堆的堆顶元素，并将该元素所在源文件的下一个数存入小根堆
* 重复上述步骤，直至所有小文件中的所有整数均被读取完毕，归并结束